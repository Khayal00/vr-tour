<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8">
  <title>VR Tour - Quest Crossfade with Laser Cursor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    body { margin: 0; }
    #welcomeScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      color: white; font-family: sans-serif;
      z-index: 10;
    }
    #startBtn {
      margin-top: 20px;
      padding: 10px 25px;
      border: none;
      border-radius: 8px;
      font-size: 20px;
      background: #2196f3;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- شاشة الترحيب -->
  <div id="welcomeScreen">
    <h1>أهلاً بك في الجولة الافتراضية</h1>
    <button id="startBtn">ابدأ الجولة</button>
  </div>

  <a-scene>
    <!-- السماوات -->
    <a-sky id="skyFront" src="#imgLiving" material="shader: flat; transparent: true; opacity: 1;"></a-sky>
    <a-sky id="skyBack" material="shader: flat; transparent: true; opacity: 0;"></a-sky>

    <!-- الصور -->
    <a-assets>
      <img id="imgLiving" src="assets/living.jpg">
      <img id="imgHall" src="assets/hall.jpg">
      <img id="imgGarden" src="assets/garden.jpg">
    </a-assets>

    <!-- HUD للنصوص -->
    <a-entity id="hud" position="0 1.6 -2"></a-entity>

    <!-- الكنترولر بالليزر -->
    <a-entity laser-controls="hand: right"
              raycaster="objects: .hotspot; showLine: true"
              cursor="rayOrigin: mouse; fuse: false"></a-entity>

    <a-entity laser-controls="hand: left"
              raycaster="objects: .hotspot; showLine: true"
              cursor="rayOrigin: mouse; fuse: false"></a-entity>

  </a-scene>

  <script>
    const scenes = {
      living: {
        img: "#imgLiving",
        hotspots: [
          {pos: "2 1.5 -3", to: "hall", label: "إلى الصالة"}
        ]
      },
      hall: {
        img: "#imgHall",
        hotspots: [
          {pos: "-2 1.5 -3", to: "living", label: "إلى غرفة المعيشة"},
          {pos: "0 1.5 -3", to: "garden", label: "إلى الحديقة"}
        ]
      },
      garden: {
        img: "#imgGarden",
        hotspots: [
          {pos: "0 1.5 -3", to: "hall", label: "إلى الصالة"}
        ]
      }
    };

    let currentScene = "living";
    const skyFront = document.querySelector("#skyFront");
    const skyBack = document.querySelector("#skyBack");
    const hud = document.querySelector("#hud");

    function loadScene(sceneName) {
      const scene = scenes[sceneName];
      if (!scene) return;

      // إعداد صورة السماء الخلفية
      skyBack.setAttribute("src", scene.img);

      // أنيميشن للانتقال
      skyBack.setAttribute("animation__fadein", {
        property: "material.opacity",
        from: 0, to: 1, dur: 2000, easing: "easeInOutQuad"
      });
      skyFront.setAttribute("animation__fadeout", {
        property: "material.opacity",
        from: 1, to: 0, dur: 2000, easing: "easeInOutQuad"
      });

      // بعد 2 ثانية، تثبيت المشهد
      setTimeout(() => {
        skyFront.setAttribute("src", scene.img);
        skyFront.setAttribute("material", "opacity", 1);
        skyBack.setAttribute("material", "opacity", 0);
      }, 2000);

      // مسح الهوت سبوتس القديمة
      document.querySelectorAll(".hotspot").forEach(el => el.remove());
      hud.innerHTML = "";

      // إنشاء الهوت سبوتس الجديدة
      scene.hotspots.forEach(hs => {
        const spot = document.createElement("a-entity");
        spot.setAttribute("geometry", "primitive: circle; radius: 0.2");
        spot.setAttribute("material", "color: #00bcd4; opacity: 0.8; shader: flat");
        spot.setAttribute("position", hs.pos);
        spot.setAttribute("class", "hotspot");
        spot.setAttribute("look-at", "[camera]");
        spot.addEventListener("click", () => loadScene(hs.to));
        document.querySelector("a-scene").appendChild(spot);

        // النص في HUD
        const text = document.createElement("a-text");
        text.setAttribute("value", hs.label);
        text.setAttribute("align", "center");
        text.setAttribute("color", "#fff");
        text.setAttribute("position", "0 -0.5 0");
        hud.appendChild(text);
      });

      currentScene = sceneName;
    }

    document.querySelector("#startBtn").addEventListener("click", () => {
      document.querySelector("#welcomeScreen").style.display = "none";
      loadScene(currentScene);
    });
  </script>
</body>
</html>
