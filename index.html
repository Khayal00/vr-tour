<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VR Tour Working Solution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        .hotspot { cursor: pointer; }
    </style>
</head>
<body>
    <a-scene loading-screen="enabled: false">
        <!-- Camera -->
        <a-entity id="camera" camera look-controls position="0 1.6 0">
            <a-cursor></a-cursor>
        </a-entity>

        <!-- Sky -->
        <a-sky id="sky" src="#livingRoom"></a-sky>

        <!-- Hotspots Container -->
        <a-entity id="hotspotContainer"></a-entity>

        <!-- Assets with working CDN URLs -->
        <a-assets timeout="30000">
            <audio id="clickSound" src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg"></audio>
            <img id="hotspotIcon" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/hotspot.png">
            <img id="livingRoom" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/living-room.jpg">
            <img id="kitchen" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/kitchen.jpg">
            <img id="bedroom" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/bedroom.jpg">
        </a-assets>
    </a-scene>

    <script>
        // Scene configuration
        const scenes = {
            Living_Room: {
                src: '#livingRoom',
                hotspots: [
                    { target: 'Kitchen', position: '-2 1.6 -3' },
                    { target: 'Bedroom', position: '2 1.6 -3' }
                ]
            },
            Kitchen: {
                src: '#kitchen',
                hotspots: [
                    { target: 'Living_Room', position: '0 1.6 -4' }
                ]
            },
            Bedroom: {
                src: '#bedroom',
                hotspots: [
                    { target: 'Living_Room', position: '0 1.6 -4' }
                ]
            }
        };

        // Initialize scene after assets load
        document.querySelector('a-scene').addEventListener('loaded', function() {
            // Create initial hotspots
            createHotspots('Living_Room');
            
            // Enable audio after first interaction
            document.body.addEventListener('click', function() {
                const audio = document.querySelector('#clickSound');
                audio.play().catch(e => console.log("Audio play requires user interaction first"));
            }, { once: true });
        });

        // Hotspot creation function
        function createHotspots(sceneName) {
            const container = document.querySelector('#hotspotContainer');
            container.innerHTML = '';
            
            scenes[sceneName].hotspots.forEach(hotspot => {
                const hotspotEl = document.createElement('a-image');
                hotspotEl.setAttribute('class', 'hotspot');
                hotspotEl.setAttribute('src', '#hotspotIcon');
                hotspotEl.setAttribute('position', hotspot.position);
                hotspotEl.setAttribute('width', 0.5);
                hotspotEl.setAttribute('height', 0.5);
                hotspotEl.setAttribute('look-at', '[camera]');
                
                // Click event
                hotspotEl.addEventListener('click', () => {
                    document.querySelector('#sky').setAttribute('src', scenes[hotspot.target].src);
                    createHotspots(hotspot.target);
                    document.querySelector('#clickSound').play().catch(console.error);
                });
                
                container.appendChild(hotspotEl);
            });
        }
    </script>
</body>
</html>
