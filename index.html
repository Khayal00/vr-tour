<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جولة واقع افتراضي بتقنية 360 درجة</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@5.1.2/dist/aframe-animation-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.1/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            overflow: hidden;
            background: #000;
        }
        
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease;
        }
        
        .loading-content {
            text-align: center;
            max-width: 800px;
            padding: 20px;
        }
        
        h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        .instructions {
            background: rgba(0, 0, 0, 0.6);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            font-size: 1.2rem;
            line-height: 1.8;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .progress-container {
            width: 80%;
            max-width: 500px;
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            margin-top: 30px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00c9ff, #92fe9d);
            border-radius: 15px;
            transition: width 0.5s ease;
        }
        
        .loading-text {
            margin-top: 20px;
            font-size: 1.3rem;
            color: #ddd;
        }
        
        #enter-vr {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 2px solid white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        #enter-vr:hover {
            background: rgba(255, 255, 255, 0.9);
            color: #1a2a6c;
            transform: translateX(-50%) scale(1.05);
        }
        
        #scene-title {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 2rem;
            text-shadow: 0 0 10px black;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
        
        .hotspot-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1.1rem;
            white-space: nowrap;
            transform: translate(-50%, -100%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .controls-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            max-width: 300px;
            opacity: 0.8;
            z-index: 10;
        }
        
        /* تصميم متجاوب */
        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            .instructions { font-size: 1rem; padding: 15px; }
            #enter-vr { padding: 12px 25px; font-size: 1.1rem; }
            #scene-title { font-size: 1.5rem; }
        }
        
        @media (max-width: 480px) {
            h1 { font-size: 2rem; }
            .instructions { font-size: 0.9rem; }
            #enter-vr { padding: 10px 20px; font-size: 1rem; }
            .controls-info { font-size: 0.8rem; bottom: 10px; left: 10px; }
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loading-content">
            <h1>جولة الواقع الافتراضي</h1>
            <div class="instructions">
                <p>مرحباً بكم في جولتنا الافتراضية بتقنية 360 درجة! ستأخذك هذه التجربة في رحلة تفاعلية عبر مساحات مختلفة.</p>
                <p>ستبدأ الجولة في غرفة الاستقبال، حيث يمكنك استخدام النقاط التفاعلية للانتقال بين الغرف المختلفة. كل نقطة تفاعلية ستنقلك إلى مشهد جديد.</p>
                <p>لتحريك المشهد: اسحب بفأرة الحاسوب أو حرك جهازك المحمول/النظارة. انقر على نقاط الهوت سبوت للانتقال إلى المشاهد الأخرى.</p>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="loading-text" id="loading-text">جاري تحميل الأصول... 0%</div>
        </div>
    </div>
    
    <button id="enter-vr">ابدأ الجولة</button>
    <div id="scene-title"></div>
    
    <div class="controls-info">
        <p>استخدم الماوس/لمس الشاشة للتحريك. انقر على نقاط الهوت سبوت للانتقال</p>
    </div>

    <a-scene vr-mode-ui="enabled: false" loading-screen="enabled: false">
        <!-- الكاميرا والتحكم -->
        <a-entity id="camera" position="0 1.6 0">
            <a-entity camera="fov: 80" look-controls="pointerLockEnabled: false" wasd-controls="enabled: false"></a-entity>
            <a-entity cursor="rayOrigin: mouse" raycaster="objects: .hotspot"></a-entity>
        </a-entity>
        
        <!-- السماء (سيتم تغييرها ديناميكياً) -->
        <a-sky id="sky" color="#000"></a-sky>
        
        <!-- نقاط الهوت سبوت (ستضاف ديناميكياً) -->
        
        <!-- إضاءة -->
        <a-entity light="type: ambient; intensity: 0.5"></a-entity>
        <a-entity light="type: point; intensity: 0.8; distance: 10" position="0 3 0"></a-entity>
        
        <!-- تأثيرات الانتقال -->
        <a-entity id="fade-effect" 
                  geometry="primitive: plane; width: 100; height: 100"
                  material="color: black; opacity: 0"
                  position="0 0 -1"
                  scale="1 1 1">
        </a-entity>
    </a-scene>

    <script>
        // إدارة حالة التطبيق
        const appState = {
            currentScene: null,
            scenes: {
                'Reception': {
                    hotspots: [
                        { position: "0 1.5 -5", target: "Living_Room", label: "غرفة المعيشة" }
                    ]
                },
                'Living_Room': {
                    hotspots: [
                        { position: "-3 1.5 -3", target: "Reception", label: "الاستقبال" },
                        { position: "3 1.5 -3", target: "Kitchen", label: "المطبخ" },
                        { position: "0 1.5 3", target: "Corridor", label: "الممر" }
                    ]
                },
                'Kitchen': {
                    hotspots: [
                        { position: "0 1.5 -5", target: "Living_Room", label: "غرفة المعيشة" }
                    ]
                },
                'Corridor': {
                    hotspots: [
                        { position: "-2 1.5 -3", target: "Bedroom", label: "غرفة النوم" },
                        { position: "2 1.5 -3", target: "Bathroom", label: "الحمام" },
                        { position: "0 1.5 3", target: "Living_Room", label: "غرفة المعيشة" }
                    ]
                },
                'Bedroom': {
                    hotspots: [
                        { position: "0 1.5 -5", target: "Corridor", label: "الممر" }
                    ]
                },
                'Bathroom': {
                    hotspots: [
                        { position: "0 1.5 -5", target: "Corridor", label: "الممر" }
                    ]
                }
            }
        };

        // عناصر DOM
        const loadingScreen = document.getElementById('loading-screen');
        const progressBar = document.getElementById('progress-bar');
        const loadingText = document.getElementById('loading-text');
        const enterVrButton = document.getElementById('enter-vr');
        const sceneTitle = document.getElementById('scene-title');
        const sky = document.getElementById('sky');
        const fadeEffect = document.getElementById('fade-effect');
        const scene = document.querySelector('a-scene');

        // صور المشاهد (تمثيلية - في تطبيق حقيقي يتم استبدالها بروابط الصور الفعلية)
        const sceneImages = {
            'Reception': 'assets/Reception.jpg',
            'Living_Room': 'assets/Living_Room.jpg',
            'Kitchen': 'https://cdn.glitch.global/1a8e1e86-3d4f-4d48-8c6f-1b3a1f4b4a9d/kitchen.jpg?v=1700000000000',
            'Corridor': 'https://cdn.glitch.global/1a8e1e86-3d4f-4d48-8c6f-1b3a1f4b4a9d/corridor.jpg?v=1700000000000',
            'Bedroom': 'https://cdn.glitch.global/1a8e1e86-3d4f-4d48-8c6f-1b3a1f4b4a9d/bedroom.jpg?v=1700000000000',
            'Bathroom': 'https://cdn.glitch.global/1a8e1e86-3d4f-4d48-8c6f-1b3a1f4b4a9d/bathroom.jpg?v=1700000000000'
        };

        // متغيرات التحميل
        let assetsLoaded = 0;
        const totalAssets = 6; // عدد المشاهد

        // محاكاة تحميل الأصول
        function simulateAssetLoading() {
            if (assetsLoaded < totalAssets) {
                assetsLoaded++;
                const progress = Math.round((assetsLoaded / totalAssets) * 100);
                progressBar.style.width = `${progress}%`;
                loadingText.textContent = `جاري تحميل الأصول... ${progress}%`;
                
                setTimeout(simulateAssetLoading, 300 + Math.random() * 300);
            } else {
                loadingText.textContent = "جاهز! انقر على الزر لبدء الجولة";
                enterVrButton.style.display = 'block';
            }
        }

        // بدء التحميل
        setTimeout(simulateAssetLoading, 1000);

        // بدء الجولة
        enterVrButton.addEventListener('click', function() {
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                enterVrButton.style.display = 'none';
                changeScene('Reception');
            }, 1000);
        });

        // تغيير المشهد
        function changeScene(sceneName) {
            // تأثير التلاشي
            fadeEffect.setAttribute('material', 'opacity', 1);
            
            setTimeout(() => {
                // تحديث المشهد
                appState.currentScene = sceneName;
                sceneTitle.textContent = sceneName === 'Reception' ? 'الاستقبال' : 
                                          sceneName === 'Living_Room' ? 'غرفة المعيشة' : 
                                          sceneName === 'Kitchen' ? 'المطبخ' : 
                                          sceneName === 'Corridor' ? 'الممر' : 
                                          sceneName === 'Bedroom' ? 'غرفة النوم' : 'الحمام';
                
                // إظهار العنوان
                sceneTitle.style.opacity = '1';
                
                // إعداد السماء
                sky.setAttribute('src', sceneImages[sceneName]);
                
                // إزالة الهوت سبوتات القديمة
                document.querySelectorAll('.hotspot').forEach(hotspot => hotspot.remove());
                
                // إضافة الهوت سبوتات الجديدة
                const hotspots = appState.scenes[sceneName].hotspots;
                hotspots.forEach((hotspot, index) => {
                    const hotspotEl = document.createElement('a-entity');
                    hotspotEl.classList.add('hotspot');
                    hotspotEl.setAttribute('position', hotspot.position);
                    hotspotEl.setAttribute('look-at', '[camera]');
                    hotspotEl.setAttribute('data-target', hotspot.target);
                    
                    // إنشاء الهوت سبوت كدائرة متحركة
                    hotspotEl.setAttribute('geometry', 'primitive: circle; radius: 0.2');
                    hotspotEl.setAttribute('material', 'shader: flat; src: #hotspot-texture; transparent: true; opacity: 0.8');
                    
                    // إضافة تأثير النبض
                    hotspotEl.setAttribute('animation', 'property: scale; from: 1 1 1; to: 1.2 1.2 1; dur: 1000; loop: true; dir: alternate; easing: easeInOutSine');
                    
                    // إضافة نص التسمية
                    const label = document.createElement('div');
                    label.classList.add('hotspot-label');
                    label.textContent = hotspot.label;
                    label.style.top = '0';
                    label.style.left = '0';
                    document.body.appendChild(label);
                    
                    // أحداث المؤشر
                    hotspotEl.addEventListener('mouseenter', function() {
                        this.setAttribute('scale', '1.3 1.3 1');
                        label.style.opacity = '1';
                    });
                    
                    hotspotEl.addEventListener('mouseleave', function() {
                        this.setAttribute('scale', '1 1 1');
                        label.style.opacity = '0';
                    });
                    
                    hotspotEl.addEventListener('click', function() {
                        const targetScene = this.getAttribute('data-target');
                        changeScene(targetScene);
                    });
                    
                    // تحديث موقع التسمية
                    hotspotEl.addEventListener('componentchanged', function(e) {
                        if (e.detail.name === 'position') {
                            const pos = this.getAttribute('position');
                            const cameraPos = document.querySelector('[camera]').getAttribute('position');
                            const screenPos = worldToScreen(pos, cameraPos);
                            
                            if (screenPos) {
                                label.style.left = `${screenPos.x}px`;
                                label.style.top = `${screenPos.y}px`;
                            }
                        }
                    });
                    
                    scene.appendChild(hotspotEl);
                });
                
                // إخفاء تأثير التلاشي
                fadeEffect.setAttribute('material', 'opacity', 0);
            }, 500);
        }

        // تحويل الإحداثيات العالمية إلى إحداثيات الشاشة
        function worldToScreen(worldPos, cameraPos) {
            // حساب متجه الرؤية
            const vector = new THREE.Vector3(
                worldPos.x - cameraPos.x,
                worldPos.y - cameraPos.y,
                worldPos.z - cameraPos.z
            );
            
            // تسوية المتجه
            vector.normalize();
            
            // افتراض أن الكاميرا تنظر في اتجاه المحور Z السلبي
            // حساب الزوايا
            const phi = Math.atan2(vector.z, vector.x); // زاوية أفقية
            const theta = Math.acos(vector.y); // زاوية رأسية
            
            // تحويل الزوايا إلى إحداثيات شاشة
            const x = (phi / (Math.PI * 2) + 0.5) * window.innerWidth;
            const y = (theta / Math.PI) * window.innerHeight;
            
            return { x, y };
        }

        // إنشاء نسيج الهوت سبوت البرمجي
        function createHotspotTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 128;
            canvas.height = 128;
            const ctx = canvas.getContext('2d');
            
            // خلفية دائرية متدرجة
            const gradient = ctx.createRadialGradient(64, 64, 0, 64, 64, 64);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient.addColorStop(0.5, 'rgba(0, 150, 255, 0.8)');
            gradient.addColorStop(1, 'rgba(0, 50, 150, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(64, 64, 60, 0, Math.PI * 2);
            ctx.fill();
            
            // حدود متحركة
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.arc(64, 64, 55, 0, Math.PI * 2);
            ctx.stroke();
            
            return canvas;
        }

        // إضافة نسيج الهوت سبوت إلى المشهد
        scene.addEventListener('loaded', function() {
            const hotspotCanvas = createHotspotTexture();
            const hotspotTexture = new THREE.CanvasTexture(hotspotCanvas);
            scene.object3D.map = hotspotTexture;
            
            // تخزين النسيج للاستخدام في A-Frame
            scene.systems.material.schema.materials['hotspot-texture'] = {
                schema: {
                    shader: 'flat',
                    src: hotspotTexture
                }
            };
        });

        // تمكين وضع VR عند توفر النظارة
        if (navigator.xr) {
            navigator.xr.isSessionSupported('immersive-vr').then((supported) => {
                if (supported) {
                    const vrButton = document.createElement('button');
                    vrButton.textContent = 'ابدأ الواقع الافتراضي';
                    vrButton.style.position = 'absolute';
                    vrButton.style.bottom = '20px';
                    vrButton.style.right = '20px';
                    vrButton.style.zIndex = '10';
                    vrButton.style.padding = '10px 20px';
                    vrButton.style.background = 'rgba(0, 0, 0, 0.7)';
                    vrButton.style.color = 'white';
                    vrButton.style.border = '2px solid white';
                    vrButton.style.borderRadius = '30px';
                    vrButton.style.cursor = 'pointer';
                    vrButton.addEventListener('click', () => {
                        scene.enterVR();
                    });
                    document.body.appendChild(vrButton);
                }
            });
        }
    </script>
</body>
</html>
