<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <title>VR 360 Tour - انعكاس الهوت سبوت</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
</head>
<body>
  <a-scene loading-screen="enabled:true" background="color: black">
    <a-assets>
      <img id="scene1" src="assets/scene1.jpg">
      <img id="scene2" src="assets/scene2.jpg">
      <img id="hotspot" src="assets/hotspot.png">
    </a-assets>

    <!-- الكاميرا -->
    <a-entity id="camera" camera look-controls position="0 1.6 0"></a-entity>

    <!-- السماء -->
    <a-sky id="sky" src="#scene1"></a-sky>

    <script>
      const scenes = {
        scene1: {
          src: "#scene1",
          hotspots: [
            { position: "2 1.5 -3", rotation: "0 0 0", target: "scene2", label: "المشهد 2" }
          ]
        },
        scene2: {
          src: "#scene2",
          hotspots: [
            { position: "-2 1.5 -3", rotation: "0 0 0", target: "scene1", label: "المشهد 1" }
          ]
        }
      };

      const sky = document.getElementById("sky");
      const sceneEl = document.querySelector("a-scene");

      function createLabel(text) {
        const labelBg = document.createElement("a-plane");
        labelBg.setAttribute("color", "#000");
        labelBg.setAttribute("opacity", "0.6");
        labelBg.setAttribute("height", "0.3");
        labelBg.setAttribute("width", `${text.length * 0.15}`);
        labelBg.setAttribute("position", "0 0.5 0");
        labelBg.setAttribute("visible", "false");

        const label = document.createElement("a-text");
        label.setAttribute("value", text);
        label.setAttribute("align", "center");
        label.setAttribute("color", "#fff");
        label.setAttribute("width", "4");
        label.setAttribute("position", "0 0 0.01");

        labelBg.appendChild(label);
        return labelBg;
      }

      function makeHotspot(h) {
        const hotspot = document.createElement("a-entity");
        hotspot.classList.add("clickable");
        hotspot.setAttribute("geometry", "primitive: plane; height: 0.6; width: 0.6");
        hotspot.setAttribute("material", "src: url(assets/hotspot.png); transparent: true; shader: flat; side: double");
        hotspot.setAttribute("look-at", "#camera");
        hotspot.setAttribute("shadow", "receive: false;cast:false");
        hotspot.setAttribute("visible", true);

        // ✨ انعكاس الهوت سبوت
        hotspot.setAttribute("scale", "-1 1 1");

        // حركة نبض
        hotspot.setAttribute("animation__pulse", "property: scale; dir: alternate; dur: 900; easing: easeInOutSine; loop: true; to: 1.12 1.12 1.12; from: 0.95 0.95 0.95");

        hotspot.setAttribute("position", h.position);
        hotspot.setAttribute("rotation", h.rotation);

        const label = createLabel(h.label);
        hotspot.appendChild(label);

        hotspot.addEventListener("mouseenter", () => {
          hotspot.setAttribute("scale", "1.3 1.3 1.3");
          label.setAttribute("visible", "true");
        });
        hotspot.addEventListener("mouseleave", () => {
          hotspot.setAttribute("scale", "1 1 1");
          label.setAttribute("visible", "false");
        });
        hotspot.addEventListener("click", () => {
          changeScene(h.target);
        });

        sceneEl.appendChild(hotspot);
        return hotspot;
      }

      let activeHotspots = [];

      function changeScene(sceneName) {
        activeHotspots.forEach(h => h.remove());
        activeHotspots = [];

        const scene = scenes[sceneName];
        sky.setAttribute("src", scene.src);

        scene.hotspots.forEach(h => {
          const hotspot = makeHotspot(h);
          activeHotspots.push(hotspot);
        });
      }

      changeScene("scene1");
    </script>
  </a-scene>
</body>
</html>
