<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VR Tour - Crossfade with Dual Cursor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- السماء الأولى -->
      <a-sky id="sky1" src="#scene1" visible="true" material="opacity:1"></a-sky>
      <!-- السماء الثانية -->
      <a-sky id="sky2" src="#scene2" visible="false" material="opacity:0"></a-sky>

      <!-- الهوت سبوتس -->
      <a-entity id="hotspots"></a-entity>

      <!-- الكاميرا + المؤشرات -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <!-- الكاميرا -->
        <a-entity camera look-controls></a-entity>

        <!-- مؤشر ثابت (VR gaze) -->
        <a-cursor id="gazeCursor"
                  raycaster="objects: .hotspot"
                  fuse="true" fuse-timeout="800"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: white; shader: flat">
        </a-cursor>

        <!-- مؤشر الماوس (PC) -->
        <a-entity id="mouseCursor"
                  cursor="rayOrigin: mouse"
                  raycaster="objects: .hotspot">
        </a-entity>

        <!-- ليزر وحدات التحكم (VR controllers) -->
        <a-entity laser-controls="hand: right" raycaster="objects: .hotspot"></a-entity>
        <a-entity laser-controls="hand: left"  raycaster="objects: .hotspot"></a-entity>
      </a-entity>

      <!-- الموارد -->
      <a-assets>
        <img id="scene1" src="scene1.jpg" />
        <img id="scene2" src="scene2.jpg" />
        <img id="scene3" src="scene3.jpg" />
      </a-assets>
    </a-scene>

    <script>
      const scenes = {
        scene1: {
          hotspots: [
            { position: "2 1.6 -3", target: "scene2" },
            { position: "-2 1.6 -3", target: "scene3" },
          ],
        },
        scene2: {
          hotspots: [
            { position: "0 1.6 -3", target: "scene1" },
          ],
        },
        scene3: {
          hotspots: [
            { position: "0 1.6 -3", target: "scene1" },
          ],
        },
      };

      let activeSky = 1;
      let currentScene = "scene1";

      function loadScene(sceneId) {
        const nextSky = activeSky === 1 ? 2 : 1;
        const skyOut = document.querySelector("#sky" + activeSky);
        const skyIn = document.querySelector("#sky" + nextSky);

        // حدف الهوت سبوت القديمة
        const hotspotContainer = document.getElementById("hotspots");
        while (hotspotContainer.firstChild) {
          hotspotContainer.removeChild(hotspotContainer.firstChild);
        }

        // اضافة الهوت سبوت الجديدة
        scenes[sceneId].hotspots.forEach((hs) => {
          const el = document.createElement("a-sphere");
          el.setAttribute("class", "hotspot");
          el.setAttribute("position", hs.position);
          el.setAttribute("radius", "0.2");
          el.setAttribute("color", "#FFF");
          el.setAttribute("opacity", "0.7");
          el.setAttribute("transparent", "true");
          el.setAttribute("event-set__mouseenter", "_event: mouseenter; color: #F00");
          el.setAttribute("event-set__mouseleave", "_event: mouseleave; color: #FFF");
          el.addEventListener("click", () => loadScene(hs.target));
          hotspotContainer.appendChild(el);
        });

        // الانتقال التدريجي
        skyIn.setAttribute("src", "#" + sceneId);
        skyIn.setAttribute("visible", "true");

        let opacityOut = 1;
        let opacityIn = 0;
        const fade = setInterval(() => {
          opacityOut -= 0.05;
          opacityIn += 0.05;
          skyOut.setAttribute("material", "opacity", Math.max(opacityOut, 0));
          skyIn.setAttribute("material", "opacity", Math.min(opacityIn, 1));
          if (opacityIn >= 1) {
            clearInterval(fade);
            skyOut.setAttribute("visible", "false");
            activeSky = nextSky;
            currentScene = sceneId;
          }
        }, 50);
      }

      loadScene(currentScene);
    </script>
  </body>
</html>
