<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <title>Ø¬ÙˆÙ„Ø© ÙˆØ§Ù‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/feiss/aframe-fade-background@master/dist/aframe-fade-background.min.js"></script>

    <style>
      body { margin: 0; background: black; }
      #loadingScreen {
        position: fixed; top:0; left:0; width:100%; height:100%;
        background:#000; color:#fff; display:flex; flex-direction:column;
        align-items:center; justify-content:center; font-family:sans-serif;
        z-index: 9999;
      }
      .progress-bar {
        width: 80%; height: 20px; background: #333; margin-top: 20px; border-radius: 10px;
        overflow: hidden;
      }
      .progress {
        height: 100%; width: 0; background: linear-gradient(90deg, #09f, #0ff);
        transition: width 0.3s;
      }
    </style>
  </head>
  <body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØ±Ø­ÙŠØ¨ -->
    <div id="loadingScreen">
      <h1>ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¬ÙˆÙ„ØªÙ†Ø§ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</h1>
      <p>Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ„Ø©...</p>
      <div class="progress-bar"><div class="progress"></div></div>
    </div>

    <a-scene fade-background="color: black" loading-screen="enabled: false">

      <!-- Ø§Ù„Ø³Ù…Ø§Ø¡ (ØµÙˆØ±Ø© 360) -->
      <a-sky id="sky" src="#Reception"></a-sky>

      <!-- Ø§Ù„ØµÙˆØ± ÙƒÙ…ØµØ§Ø¯Ø± -->
      <a-assets>
        <img id="Reception" src="reception.jpg" crossorigin="anonymous" />
        <img id="Kitchen" src="kitchen.jpg" crossorigin="anonymous" />
        <img id="Corridor" src="corridor.jpg" crossorigin="anonymous" />
        <img id="Living_Room" src="livingroom.jpg" crossorigin="anonymous" />
        <img id="Bedroom" src="bedroom.jpg" crossorigin="anonymous" />
        <img id="Bathroom" src="bathroom.jpg" crossorigin="anonymous" />
        <img id="hotspot" src="hotspot.png" crossorigin="anonymous" />
      </a-assets>

      <!-- Ù†Ù‚Ø§Ø· Ø§Ù„Ù‡ÙˆØª Ø³Ø¨ÙˆØª Ù„ÙƒÙ„ Ù…Ø´Ù‡Ø¯ -->
      <a-entity id="hotspots"></a-entity>

      <!-- ÙƒØ§Ù…ÙŠØ±Ø§ -->
      <a-entity camera look-controls position="0 1.6 0" cursor="fuse: false; rayOrigin: mouse"
                raycaster="objects: .clickable"></a-entity>
    </a-scene>

    <script>
      const scenes = {
        "Reception": [
          { target: "Living_Room", position: "5 1 -3" }
        ],
        "Kitchen": [
          { target: "Living_Room", position: "-4 1 2" }
        ],
        "Corridor": [
          { target: "Living_Room", position: "2 1 -4" },
          { target: "Bedroom", position: "-3 1 -2" },
          { target: "Bathroom", position: "3 1 2" }
        ],
        "Living_Room": [
          { target: "Reception", position: "0 1 -4" },
          { target: "Kitchen", position: "4 1 0" },
          { target: "Corridor", position: "-4 1 1" }
        ],
        "Bedroom": [
          { target: "Corridor", position: "2 1 -3" }
        ],
        "Bathroom": [
          { target: "Corridor", position: "-2 1 -3" }
        ]
      };

      const sky = document.querySelector("#sky");
      const hotspotContainer = document.querySelector("#hotspots");

      function createHotspot(target, position) {
        const hotspot = document.createElement("a-image");
        hotspot.setAttribute("src", "#hotspot");
        hotspot.setAttribute("position", position);
        hotspot.setAttribute("scale", "1 1 1");
        hotspot.setAttribute("opacity", "0.9");
        hotspot.setAttribute("class", "clickable");
        hotspot.setAttribute("look-at", "[camera]");
        
        // Ù†Ø¨Ø¶ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø¤Ø´Ø±
        hotspot.addEventListener("mouseenter", () => {
          hotspot.setAttribute("animation__pulse", {
            property: "scale",
            to: "1.3 1.3 1.3",
            dur: 300,
            easing: "easeOutElastic"
          });
        });
        hotspot.addEventListener("mouseleave", () => {
          hotspot.setAttribute("animation__pulse", {
            property: "scale",
            to: "1 1 1",
            dur: 300
          });
        });

        hotspot.addEventListener("click", () => {
          changeScene(target);
        });
        
        hotspotContainer.appendChild(hotspot);
      }

      function changeScene(name) {
        sky.emit('fade'); // Ø§Ù„ØªÙ„Ø§Ø´ÙŠ
        setTimeout(() => {
          sky.setAttribute("src", "#" + name);
          loadHotspots(name);
        }, 500);
      }

      function loadHotspots(sceneName) {
        hotspotContainer.innerHTML = "";
        scenes[sceneName].forEach(h => {
          createHotspot(h.target, h.position);
        });
      }

      // Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ù€ Reception
      loadHotspots("Reception");

      // Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
      const assets = document.querySelector("a-assets");
      const progressEl = document.querySelector(".progress");
      assets.addEventListener("progress", e => {
        if (e.detail.total) {
          let pct = (e.detail.loaded / e.detail.total) * 100;
          progressEl.style.width = pct + "%";
        }
      });
      assets.addEventListener("loaded", () => {
        document.getElementById("loadingScreen").style.display = "none";
      });
    </script>
  </body>
</html>
