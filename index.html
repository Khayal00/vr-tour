<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>VR Tour - Meta Quest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-event-set-component@5.0.1/dist/aframe-event-set-component.min.js"></script>
    <script>
      AFRAME.registerComponent("hotspot", {
        schema: { target: { type: "string" } },
        init: function () {
          const el = this.el;
          el.addEventListener("mouseenter", () => {
            el.setAttribute("scale", "1.3 1.3 1.3");
          });
          el.addEventListener("mouseleave", () => {
            el.setAttribute("scale", "1 1 1");
          });
          el.addEventListener("click", () => {
            fadeToScene(this.data.target);
          });
        },
      });

      let currentScene = "Reception";

      function fadeToScene(target) {
        const fade = document.querySelector("#fade");
        fade.emit("fadeout");
        setTimeout(() => {
          currentScene = target;
          document.querySelector("#sky").setAttribute("src", "#"+target);
          updateHotspots(target);
          fade.emit("fadein");
        }, 1000);
      }

      function updateHotspots(scene) {
        document.querySelectorAll(".hotspot").forEach(h => h.parentNode.removeChild(h));
        const hotspotData = {
          Reception: [{pos:"2 1 -3",target:"Living_Room",label:"Living Room"}],
          Kitchen:   [{pos:"2 1 -3",target:"Living_Room",label:"Living Room"}],
          Corridor:  [{pos:"2 1 -3",target:"Living_Room",label:"Living Room"},
                      {pos:"-2 1 -3",target:"Bedroom",label:"Bedroom"},
                      {pos:"2 1 -1",target:"Bathroom",label:"Bathroom"}],
          Living_Room:[
                      {pos:"-2 1 -3",target:"Reception",label:"Reception"},
                      {pos:"2 1 -3",target:"Kitchen",label:"Kitchen"},
                      {pos:"0 1 -3",target:"Corridor",label:"Corridor"}],
          Bedroom:  [{pos:"0 1 -3",target:"Corridor",label:"Corridor"}],
          Bathroom: [{pos:"0 1 -3",target:"Corridor",label:"Corridor"}]
        };

        const sceneEl = document.querySelector("a-scene");
        if (hotspotData[scene]) {
          hotspotData[scene].forEach(h => {
            const hs = document.createElement("a-image");
            hs.setAttribute("src", "#hotspotIcon");
            hs.setAttribute("position", h.pos);
            hs.setAttribute("scale", "1 1 1");
            hs.setAttribute("class", "hotspot");
            hs.setAttribute("hotspot", "target:"+h.target);
            hs.setAttribute("animation","property: scale; dir: alternate; dur: 1000; easing: easeInOutSine; loop: true; to: 1.2 1.2 1.2");
            
            // label
            const txt = document.createElement("a-text");
            txt.setAttribute("value", h.label);
            txt.setAttribute("align", "center");
            txt.setAttribute("position", "0 0.5 0");
            txt.setAttribute("color", "white");
            txt.setAttribute("scale", "1.5 1.5 1.5");
            hs.appendChild(txt);

            sceneEl.appendChild(hs);
          });
        }
      }

      window.onload = () => {
        updateHotspots(currentScene);
      };
    </script>
    <style>
      body {margin:0;}
      #overlay {
        position: fixed;
        width: 100%; height: 100%;
        background: black; color: white;
        display: flex; align-items: center; justify-content: center;
        flex-direction: column;
        z-index: 9999;
      }
      #startBtn {
        margin-top: 20px; padding: 10px 20px;
        background: white; color: black; border:none; cursor:pointer;
        font-size: 18px; border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <!-- شاشة البداية -->
    <div id="overlay">
      <h1>Welcome to the Virtual Tour</h1>
      <p>Explore the spaces using your Meta Quest, Mobile, or PC</p>
      <button id="startBtn">Start Tour</button>
    </div>

    <a-scene>
      <!-- الصور -->
      <a-assets>
        <img id="Reception" src="assets/Reception.jpg">
        <img id="Kitchen" src="assets/Kitchen.jpg">
        <img id="Corridor" src="assets/Corridor.jpg">
        <img id="Living_Room" src="assets/Living_Room.jpg">
        <img id="Bedroom" src="assets/Bedroom.jpg">
        <img id="Bathroom" src="assets/Bathroom.jpg">
        <img id="hotspotIcon" src="assets/hotspot.png">
      </a-assets>

      <!-- المشهد -->
      <a-sky id="sky" src="#Reception" rotation="0 -90 0"></a-sky>

      <!-- التلاشي -->
      <a-plane id="fade" position="0 0 -1" width="2" height="2" material="color:black; transparent:true; opacity:0" visible="true">
        <a-animation attribute="material.opacity" begin="fadeout" to="1" dur="1000"></a-animation>
        <a-animation attribute="material.opacity" begin="fadein" to="0" dur="1000"></a-animation>
      </a-plane>
      
      <a-camera wasd-controls-enabled="false">
        <a-cursor></a-cursor>
      </a-camera>
    </a-scene>

    <script>
      document.querySelector("#startBtn").onclick = () => {
        document.querySelector("#overlay").style.display = "none";
      };
    </script>
  </body>
</html>
