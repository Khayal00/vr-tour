<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Tour with Zoom Transition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }

      /* شاشة الترحيب */
      #welcomeScreen {
        position: fixed;
        top:0; left:0; width:100%; height:100%;
        background: linear-gradient(135deg,#1a1a1a,#000000);
        display:flex; flex-direction:column;
        align-items:center; justify-content:center;
        color:white; z-index:9999;
      }

      #welcomeScreen h1 {
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 0 0 8px rgba(255,255,255,0.6);
      }

      #instructions {
        font-size: 1em;
        margin-bottom: 30px;
        opacity: 0.85;
      }

      .progress-container {
        width: 60%;
        background: rgba(255,255,255,0.2);
        border-radius: 8px;
        overflow: hidden;
        height: 20px;
        margin-bottom: 25px;
      }
      .progress-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #4facfe, #00f2fe);
        transition: width 0.3s;
      }

      #startBtn {
        padding: 12px 28px;
        border: none;
        border-radius: 30px;
        background: #4facfe;
        color: white;
        font-size: 1.1em;
        cursor: pointer;
        display:none;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
      }
      #startBtn:hover {
        background: #00f2fe;
      }
    </style>
  </head>
  <body>
    <!-- شاشة الترحيب -->
    <div id="welcomeScreen">
      <h1>✨ VR Tour ✨</h1>
      <div id="instructions">استخدم الماوس أو الهاتف للتحريك والنظر حولك</div>
      <div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
      <button id="startBtn">ابدأ الجولة</button>
    </div>

    <!-- المشهد -->
    <a-scene>
      <a-entity id="cameraRig" camera look-controls position="0 1.6 0">
        <a-cursor
          rayOrigin="mouse"
          raycaster="objects: .hotspot"
          fuse="false"
          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
          material="color: white; shader: flat">
        </a-cursor>

        <!-- HUD -->
        <a-text id="sceneLabel" value="Living Room" position="-1.2 0.8 -1"
          align="center" color="#FFFFFF" width="1"></a-text>

        <a-entity id="hudPlane" position="-1.2 0.8 -1">
          <a-plane width="0.3" height="0.1"
            material="color: #000000; opacity: 0.5; side: double; transparent: true">
          </a-plane>
        </a-entity>
      </a-entity>

      <!-- السماء مع أنميشن للـ Zoom -->
      <a-sky id="sky" rotation="0 -90 0"
        animation__zoomout="property: scale; to: 1 1 1; dur: 700; startEvents: zoomOut"
        animation__zoomin="property: scale; to: 1.5 1.5 1; dur: 700; startEvents: zoomIn">
      </a-sky>

      <a-entity id="hotspotContainer"></a-entity>

      <a-assets>
        <audio id="transitionSound" src="assets/transition.mp3"></audio>
        <!-- صور المشاهد -->
        <img id="imgLiving" src="assets/Living_Room.jpg">
        <img id="imgKitchen" src="assets/Kitchen.jpg">
        <img id="imgReception" src="assets/Reception.jpg">
        <img id="imgCorridor" src="assets/Corridor.jpg">
        <img id="imgBathroom" src="assets/Bathroom.jpg">
        <img id="imgBedroom" src="assets/Bedroom.jpg">
      </a-assets>
    </a-scene>

    <script>
      // شاشة الترحيب
      const assets = document.querySelector('a-assets');
      const progressBar = document.getElementById('progressBar');
      const startBtn = document.getElementById('startBtn');
      const welcomeScreen = document.getElementById('welcomeScreen');

      assets.addEventListener('progress', (e) => {
        const loaded = e.detail.loadedBytes;
        const total = e.detail.totalBytes;
        let percent = total > 0 ? Math.floor((loaded/total)*100) : 0;
        progressBar.style.width = percent + '%';
      });

      assets.addEventListener('loaded', () => {
        progressBar.style.width = '100%';
        startBtn.style.display = 'block';
      });

      startBtn.addEventListener('click', () => {
        welcomeScreen.style.transition = 'opacity 0.7s';
        welcomeScreen.style.opacity = '0';
        setTimeout(() => { welcomeScreen.style.display = 'none'; }, 700);
      });

      // تغيير المشاهد مع Zoom
      const scenes = {
        "Living Room": { img: "#imgLiving", hotspots: [{ position:"1 1 -3", label:"Kitchen", target:"Kitchen"}] },
        "Kitchen": { img: "#imgKitchen", hotspots: [{ position:"-1 1 -3", label:"Reception", target:"Reception"}] },
        "Reception": { img: "#imgReception", hotspots: [{ position:"0 1 -3", label:"Corridor", target:"Corridor"}] },
        "Corridor": { img: "#imgCorridor", hotspots: [{ position:"1 1 -3", label:"Bathroom", target:"Bathroom"}] },
        "Bathroom": { img: "#imgBathroom", hotspots: [{ position:"0 1 -3", label:"Bedroom", target:"Bedroom"}] },
        "Bedroom": { img: "#imgBedroom", hotspots: [{ position:"0 1 -3", label:"Living Room", target:"Living Room"}] }
      };

      const sky = document.querySelector("#sky");
      const sceneLabel = document.querySelector("#sceneLabel");
      const hotspotContainer = document.querySelector("#hotspotContainer");
      const sound = document.querySelector("#transitionSound");

      function changeScene(name) {
        const scene = scenes[name];
        if (!scene) return;

        // تشغيل صوت
        sound.play();

        // Zoom In
        sky.emit("zoomin");

        // بعد الانتهاء من الـ zoomin نبدل الصورة
        setTimeout(() => {
          sky.setAttribute("src", scene.img);
          sceneLabel.setAttribute("value", name);

          // مسح الهوت سبوتات
          hotspotContainer.innerHTML = "";

          // إضافة الهوت سبوتات
          scene.hotspots.forEach(h => {
            const hotspot = document.createElement("a-entity");
            hotspot.setAttribute("geometry", "primitive: sphere; radius: 0.2");
            hotspot.setAttribute("material", "color: yellow; emissive: orange; emissiveIntensity:0.6; shader:flat");
            hotspot.setAttribute("position", h.position);
            hotspot.classList.add("hotspot");

            // نص فوق الهوت سبوت
            const label = document.createElement("a-text");
            label.setAttribute("value", h.label);
            label.setAttribute("align", "center");
            label.setAttribute("position", "0 0.3 0");
            label.setAttribute("color", "white");
            label.setAttribute("look-at", "#cameraRig");
            hotspot.appendChild(label);

            hotspot.addEventListener("click", () => changeScene(h.target));
            hotspotContainer.appendChild(hotspot);
          });

          // Zoom Out
          sky.emit("zoomOut");
        }, 700);
      }

      // المشهد الأول
      changeScene("Living Room");
    </script>
  </body>
</html>
