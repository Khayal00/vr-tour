<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VR Tour with Cursor Color Change</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #welcomeScreen {
        position: fixed; top:0; left:0; width:100%; height:100%;
        background:#000; display:flex; align-items:center; justify-content:center;
        flex-direction:column; z-index: 9999;
      }
      #progressBarContainer {
        width: 60%; height: 10px; background: #333; margin-top: 20px;
      }
      #progressBar { width:0%; height:100%; background:#00f2fe; }
      #startBtn {
        margin-top: 20px; padding:10px 20px; background:#00f2fe;
        color:#000; border:none; font-size:18px; cursor:pointer; display:none;
      }
    </style>
  </head>
  <body>
    <!-- شاشة الترحيب -->
    <div id="welcomeScreen">
      <h1 style="color:white;">أهلاً بك في الجولة الافتراضية</h1>
      <div id="progressBarContainer"><div id="progressBar"></div></div>
      <button id="startBtn">ابدأ الجولة</button>
    </div>

    <a-scene>
      <a-assets>
        <img id="Living_Room" src="living.jpg">
        <img id="Kitchen" src="kitchen.jpg">
      </a-assets>

      <!-- الخلفيات -->
      <a-sky id="skyFront" src="#Living_Room" rotation="0 -90 0"
             material="shader: flat; transparent: true; opacity: 1"></a-sky>
      <a-sky id="skyBack" rotation="0 -90 0"
             material="shader: flat; transparent: true; opacity: 0"></a-sky>

      <!-- الكاميرا والمؤشر -->
      <a-entity camera look-controls>
        <a-cursor id="cursor"
                  fuse="true" fuse-timeout="800"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: white; shader: flat; opacity: 0.9"
                  raycaster="objects: .hotspot">
          <a-animation attribute="scale"
                       from="1 1 1" to="1.3 1.3 1.3"
                       dur="1000" direction="alternate"
                       repeat="indefinite" easing="easeInOutSine"></a-animation>
        </a-cursor>
      </a-entity>
    </a-scene>

    <script>
      const scenes = {
        'Living_Room': {
          src: '#Living_Room',
          hotspots: [
            { position: '3 1 -2', rotation: '0 150 0', target: 'Kitchen' }
          ]
        },
        'Kitchen': {
          src: '#Kitchen',
          hotspots: [
            { position: '-3 1 -2', rotation: '0 30 0', target: 'Living_Room' }
          ]
        }
      };

      const skyFront = document.getElementById('skyFront');
      const skyBack  = document.getElementById('skyBack');
      const cursor   = document.getElementById('cursor');
      const sceneEl  = document.querySelector('a-scene');

      function createHotspots(sceneName) {
        document.querySelectorAll('.hotspot').forEach(h => h.remove());
        const scene = scenes[sceneName];
        scene.hotspots.forEach(h => {
          const el = document.createElement('a-entity');
          el.setAttribute('geometry','primitive: circle; radius:0.3');
          el.setAttribute('material','color: #00f2fe; opacity: 0.7; shader: flat; side: double');
          el.setAttribute('position', h.position);
          el.setAttribute('rotation', h.rotation);
          el.setAttribute('class','hotspot');

          // لون المؤشر عند المرور
          el.addEventListener('mouseenter', () => {
            cursor.setAttribute('material','color: #00f2fe; shader: flat; opacity: 0.9');
          });
          el.addEventListener('mouseleave', () => {
            cursor.setAttribute('material','color: white; shader: flat; opacity: 0.9');
          });

          // الانتقال عند الضغط
          el.addEventListener('click', () => changeScene(h.target));
          sceneEl.appendChild(el);
        });
      }

      function changeScene(sceneName) {
        const next = scenes[sceneName];
        const duration = 800; // سرعة الانتقال

        skyBack.setAttribute('src', next.src);
        skyBack.setAttribute('material','shader: flat; transparent: true; opacity: 0');

        skyBack.setAttribute('animation__fadein',{
          property:'material.opacity', from:0, to:1, dur:duration, easing:'easeInOutQuad'
        });
        skyFront.setAttribute('animation__fadeout',{
          property:'material.opacity', from:1, to:0, dur:duration, easing:'easeInOutQuad'
        });

        setTimeout(() => {
          skyFront.setAttribute('src', next.src);
          skyFront.setAttribute('material','shader: flat; transparent: true; opacity:1');
          skyBack.setAttribute('material','shader: flat; transparent: true; opacity:0');
          createHotspots(sceneName);
        }, duration);
      }

      // شاشة الترحيب
      const assets = document.querySelector('a-assets');
      const progressBar = document.getElementById('progressBar');
      const startBtn = document.getElementById('startBtn');
      const welcomeScreen = document.getElementById('welcomeScreen');

      assets.addEventListener('progress', e => {
        const loaded = e.detail?.loadedBytes || 0;
        const total  = e.detail?.totalBytes  || 0;
        const percent = total>0 ? Math.floor((loaded/total)*100) : 0;
        progressBar.style.width = percent + '%';
      });
      assets.addEventListener('loaded', () => {
        progressBar.style.width = '100%';
        startBtn.style.display = 'block';
      });
      startBtn.addEventListener('click', () => {
        welcomeScreen.style.transition = 'opacity 0.7s';
        welcomeScreen.style.opacity = '0';
        setTimeout(()=> welcomeScreen.style.display='none',700);
        createHotspots('Living_Room');
      });
    </script>
  </body>
</html>
