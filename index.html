<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Tour with Hotspots</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  </head>
  <body>
    <a-scene loading-screen="enabled:false">
      <!-- الكاميرا -->
      <a-entity id="cameraRig">
        <a-camera id="camera" wasd-controls-enabled="false" look-controls="reverseMouseDrag:true"></a-camera>
      </a-entity>

      <!-- بانوراما -->
      <a-sky id="sky" radius="10" src="assets/scene1.jpg"></a-sky>

      <!-- طبقة التلاشي -->
      <a-plane id="fade" color="black" width="30" height="30" position="0 0 -5" visible="false"></a-plane>

      <!-- الهوت سبوت -->
      <a-entity id="hotspots"></a-entity>
    </a-scene>

    <script>
      const scenes = {
        scene1: {
          image: 'assets/scene1.jpg',
          hotspots: [
            { position: '2 1 -3', target: 'scene2', label: 'الانتقال للمشهد 2' }
          ]
        },
        scene2: {
          image: 'assets/scene2.jpg',
          hotspots: [
            { position: '-2 1 -3', target: 'scene1', label: 'العودة للمشهد 1' }
          ]
        }
      };

      const sky = document.querySelector('#sky');
      const fade = document.querySelector('#fade');
      const hotspotsRoot = document.querySelector('#hotspots');

      function makeHotspot(h) {
        const hotspot = document.createElement('a-entity');
        hotspot.classList.add('clickable');
        hotspot.setAttribute('geometry', 'primitive: plane; height: 0.6; width: 0.6');
        hotspot.setAttribute('material', 'src: url(assets/hotspot.png); transparent: true; shader: flat; side: double');
        hotspot.setAttribute('look-at', '#camera');
        hotspot.setAttribute('position', h.position);

        // نبض
        hotspot.setAttribute('animation__pulse', 'property: scale; dir: alternate; dur: 900; easing: easeInOutSine; loop: true; to: 1.12 1.12 1.12; from: 0.95 0.95 0.95');

        // النص فقط (بدون خلفية)
        const label = document.createElement('a-entity');
        label.setAttribute('text', `value: ${h.label}; align: center; wrapCount: 20; width: 1.7; color: #FFFFFF;`);
        label.setAttribute('position', `0 0.62 0.02`);
        label.setAttribute('visible', false);

        hotspot.addEventListener('mouseenter', () => {
          hotspot.setAttribute('animation__hover', 'property: scale; to: 1.45 1.45 1.45; dur: 180; easing: easeOutQuad');
          label.setAttribute('visible', true);
        });
        hotspot.addEventListener('mouseleave', () => {
          hotspot.setAttribute('animation__hover', 'property: scale; to: 1 1 1; dur: 150; easing: easeOutQuad');
          label.setAttribute('visible', false);
        });

        hotspot.addEventListener('click', () => {
          const tgt = h.target;
          if (tgt) {
            disableHotspots();
            hotspotsRoot.setAttribute('visible', 'false');
            fadeToScene(tgt);
          }
        });

        hotspot.appendChild(label);
        return hotspot;
      }

      function disableHotspots() {
        const all = hotspotsRoot.querySelectorAll('.clickable');
        all.forEach(h => h.classList.remove('clickable'));
      }

      function fadeToScene(sceneName) {
        fade.setAttribute('visible', 'true');
        fade.setAttribute('material', 'opacity:0');
        fade.setAttribute('animation__fadein', 'property: material.opacity; to:1; dur:500; easing:linear');
        fade.addEventListener('animationcomplete__fadein', function () {
          loadScene(sceneName);
          fade.setAttribute('animation__fadeout', 'property: material.opacity; to:0; dur:500; easing:linear');
          fade.addEventListener('animationcomplete__fadeout', function () {
            fade.setAttribute('visible', 'false');
          }, { once: true });
        }, { once: true });
      }

      function loadScene(sceneName) {
        const scene = scenes[sceneName];
        sky.setAttribute('src', scene.image);

        while (hotspotsRoot.firstChild) {
          hotspotsRoot.removeChild(hotspotsRoot.firstChild);
        }

        scene.hotspots.forEach(h => {
          const hotspot = makeHotspot(h);
          hotspotsRoot.appendChild(hotspot);
        });
      }

      loadScene('scene1');
    </script>
  </body>
</html>
