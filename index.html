<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Tour — Hotspots with Glow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <style>
      body, html {
        margin: 0; padding: 0; overflow: hidden; height: 100%; width: 100%;
      }
      #welcomeScreen {
        position: absolute; top: 0; left: 0;
        width: 100%; height: 100%;
        background: #000; display: flex;
        flex-direction: column; align-items: center; justify-content: center;
        color: #fff; font-family: sans-serif;
        z-index: 999;
      }
      #enterBtn {
        margin-top: 20px; padding: 10px 20px;
        background: #1e90ff; border: none;
        color: #fff; font-size: 18px; border-radius: 8px;
        cursor: pointer;
      }
      #fadeOverlay {
        position: absolute; top: 0; left: 0;
        width: 100%; height: 100%;
        background: black; opacity: 0; pointer-events: none;
        transition: opacity 1s ease;
        z-index: 500;
      }
    </style>
  </head>
  <body>
    <!-- شاشة الترحيب -->
    <div id="welcomeScreen">
      <h1>أهلاً بك في الجولة الافتراضية</h1>
      <p>استعمل المؤشر وانقر على الهوت سبوت للتنقل بين المشاهد.</p>
      <button id="enterBtn">ابدأ الجولة</button>
    </div>

    <!-- شاشة التلاشي -->
    <div id="fadeOverlay"></div>

    <!-- المشهد -->
    <a-scene>
      <a-entity id="cameraRig">
        <a-camera>
          <a-cursor 
            id="cursor"
            fuse="true" fuse-timeout="1000"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
            material="color: cyan; shader: flat"
            position="0 0 -1">
          </a-cursor>
        </a-camera>
      </a-entity>

      <!-- الخلفيات -->
      <a-sky id="skyBack" radius="30" opacity="0"></a-sky>
      <a-sky id="skyFront" radius="30" opacity="1"></a-sky>

      <!-- الحاوية للهوت سبوت -->
      <a-entity id="hotspotContainer"></a-entity>
    </a-scene>

    <script>
      const fadeOverlay = document.getElementById('fadeOverlay');
      const skyFront = document.getElementById('skyFront');
      const skyBack = document.getElementById('skyBack');
      const hotspotContainer = document.getElementById('hotspotContainer');

      // بيانات المشاهد
      const scenes = {
        scene1: 'https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg',
        scene2: 'https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg',
        scene3: 'https://cdn.aframe.io/360-image-gallery-boilerplate/img/chapel.jpg'
      };

      // بيانات الهوت سبوت
      const hotspotsData = {
        scene1: [
          { position: "2 1.5 -3", target: "scene2", img: "https://cdn-icons-png.flaticon.com/512/25/25694.png" }
        ],
        scene2: [
          { position: "-2 1.5 -3", target: "scene3", img: "https://cdn-icons-png.flaticon.com/512/25/25694.png" }
        ],
        scene3: [
          { position: "0 1.5 -3", target: "scene1", img: "https://cdn-icons-png.flaticon.com/512/25/25694.png" }
        ]
      };

      let currentScene = 'scene1';
      skyFront.setAttribute('src', scenes[currentScene]);
      createHotspots(currentScene);

      // شاشة البداية
      document.getElementById('enterBtn').addEventListener('click', () => {
        document.getElementById('welcomeScreen').style.display = 'none';
      });

      // تغيير المشهد مع انتقال سلس
      function changeScene(targetScene) {
        // أخفي كل الهوت سبوتات القديمة فورًا
        Array.from(hotspotContainer.children).forEach(el => {
          el.setAttribute('visible', 'false');
        });

        fadeOverlay.style.opacity = 1; // ابدأ التلاشي
        setTimeout(() => {
          // بدّل الصور
          skyBack.setAttribute('src', scenes[targetScene]);
          skyBack.setAttribute('opacity', 1);
          skyFront.setAttribute('opacity', 0);

          // بعد التلاشي أعد الترتيب
          setTimeout(() => {
            skyFront.setAttribute('src', scenes[targetScene]);
            skyFront.setAttribute('opacity', 1);
            skyBack.setAttribute('opacity', 0);

            currentScene = targetScene;
            createHotspots(targetScene);

            fadeOverlay.style.opacity = 0;
          }, 1000);
        }, 500);
      }

      // إنشاء الهوت سبوتات مع التوهج
      function createHotspots(sceneName) {
        hotspotContainer.innerHTML = '';

        hotspotsData[sceneName].forEach(hs => {
          // 🔹 التوهج
          const glow = document.createElement('a-circle');
          glow.setAttribute('radius', hs.glowSize || 1.2);
          glow.setAttribute('color', '#ffffff');
          glow.setAttribute('opacity', 0.35);
          glow.setAttribute('position', hs.position);
          glow.setAttribute('look-at', '#cameraRig');
          glow.setAttribute('scale', '1 1 1');
          glow.setAttribute('animation__pulse',
            'property: scale; dir: alternate; dur: 2000; loop: true; to: 1.5 1.5 1');

          // 🔹 الهوت سبوت
          const el = document.createElement('a-plane');
          el.setAttribute('class', 'hotspot');
          el.setAttribute('position', hs.position);
          el.setAttribute('width', hs.size || 0.6);
          el.setAttribute('height', hs.size || 0.6);
          el.setAttribute('material', `src: url(${hs.img}); transparent: true; shader: flat; opacity: 1`);
          el.setAttribute('look-at', '#cameraRig');
          el.setAttribute('scale', '0 0 0');

          // أنيميشن ظهور
          el.setAttribute('animation__popin',
            'property: scale; to: 1 1 1; dur: 600; easing: easeOutBack');

          // بعد الظهور يبدأ النبض
          el.addEventListener('animationcomplete__popin', () => {
            el.setAttribute('animation__pulse',
              'property: scale; dir: alternate; dur: 1500; loop: true; to: 1.3 1.3 1.3');
          });

          // حدث النقر
          el.addEventListener('click', () => {
            if (hs.target) {
              changeScene(hs.target);
            }
          });

          hotspotContainer.appendChild(glow);
          hotspotContainer.appendChild(el);
        });
      }
    </script>
  </body>
</html>
