<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VR Tour with White Cursor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #welcomeScreen {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: #000;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        z-index: 9999;
      }
      #progressBar {
        width: 60%; height: 12px; background: #444; border-radius: 6px; overflow: hidden; margin-top: 15px;
      }
      #progressFill {
        width: 0%; height: 100%; background: #fff; transition: width 0.3s;
      }
      #startButton {
        margin-top: 20px; padding: 12px 24px; background: #fff; color: #000;
        border: none; border-radius: 6px; cursor: pointer; font-size: 16px;
      }
      #startButton:hover { background: #ddd; }
    </style>
  </head>
  <body>
    <!-- شاشة الترحيب -->
    <div id="welcomeScreen">
      <h1 style="color: white; font-family: sans-serif;">مرحباً بك في الجولة الافتراضية</h1>
      <div id="progressBar"><div id="progressFill"></div></div>
      <button id="startButton" style="display: none;">ابدأ الجولة</button>
    </div>

    <a-scene>
      <!-- المشاهد -->
      <a-assets>
        <img id="scene1" src="scene1.jpg">
        <img id="scene2" src="scene2.jpg">
        <audio id="transitionSound" src="transition.mp3"></audio>
      </a-assets>

      <a-sky id="sky" src="#scene1"></a-sky>

      <!-- الهوت سبوت -->
      <a-entity id="hotspot1" class="hotspot" geometry="primitive: circle; radius: 0.3"
                material="shader: flat; src: hotspot.png; transparent: true; opacity: 0.9"
                position="2 1.5 -3" look-at="[camera]"
                animation__enter="startEvents: mouseenter; property: scale; to: 1.3 1.3 1.3; dur: 300; easing: easeOutCubic"
                animation__leave="startEvents: mouseleave; property: scale; to: 1 1 1; dur: 300; easing: easeOutCubic">
      </a-entity>

      <!-- الكاميرا والمؤشر -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <a-entity camera look-controls>
          <a-entity id="cursorContainer" position="0 0 -1">
            <a-cursor id="cursor"
                      fuse="true" fuse-timeout="800"
                      geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
                      material="color: white; shader: flat; opacity: 0.9; side: double; depthTest: false"
                      raycaster="objects: .hotspot">
              <a-animation attribute="scale"
                           from="1 1 1" to="1.2 1.2 1.2"
                           dur="1000"
                           direction="alternate"
                           repeat="indefinite"
                           easing="easeInOutSine"></a-animation>
            </a-cursor>
          </a-entity>
        </a-entity>

        <!-- الكنترولرز -->
        <a-entity laser-controls="hand: right" raycaster="objects: .hotspot"></a-entity>
        <a-entity laser-controls="hand: left"  raycaster="objects: .hotspot"></a-entity>
      </a-entity>
    </a-scene>

    <script>
      const welcomeScreen = document.getElementById('welcomeScreen');
      const startButton = document.getElementById('startButton');
      const progressFill = document.getElementById('progressFill');
      const assets = document.querySelectorAll('a-assets img');
      let loaded = 0;

      assets.forEach(asset => {
        asset.addEventListener('load', () => {
          loaded++;
          progressFill.style.width = (loaded / assets.length * 100) + '%';
          if (loaded === assets.length) startButton.style.display = 'block';
        });
      });

      startButton.addEventListener('click', () => {
        welcomeScreen.style.display = 'none';
      });

      // الانتقال بين المشاهد
      document.querySelector('#hotspot1').addEventListener('click', () => {
        const sky = document.getElementById('sky');
        const transitionSound = document.getElementById('transitionSound');
        transitionSound.play();

        sky.setAttribute('animation__fadeout', {
          property: 'material.opacity',
          to: 0,
          dur: 700,
          easing: 'easeInOutQuad'
        });

        setTimeout(() => {
          sky.setAttribute('src', '#scene2');
          sky.setAttribute('animation__fadein', {
            property: 'material.opacity',
            to: 1,
            dur: 700,
            easing: 'easeInOutQuad'
          });
        }, 700);
      });
    </script>
  </body>
</html>
