<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Tour مع شاشة ترحيب وانتقال سلس</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component/dist/aframe-event-set-component.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component/dist/aframe-look-at-component.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #welcomeScreen {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background:#111;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      color:white;
      font-family:Arial, sans-serif;
      z-index:9999;
    }
    #progressBarContainer {
      width:60%;
      height:20px;
      background:#333;
      border-radius:10px;
      overflow:hidden;
      margin-top:20px;
    }
    #progressBar {
      width:0%;
      height:100%;
      background:#39ff14;
      transition: width 0.3s;
    }
    #startButton {
      margin-top:25px;
      padding:10px 20px;
      background:#39ff14;
      color:#000;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:16px;
      font-weight:bold;
    }
    #startButton:hover { background:#55ff55; }
  </style>
</head>
<body>
  <!-- شاشة الترحيب -->
  <div id="welcomeScreen">
    <h1>👋 أهلاً بك في الجولة الافتراضية</h1>
    <p>✨ استعمل المؤشر لاختيار النقاط للتنقل بين المشاهد</p>
    <div id="progressBarContainer">
      <div id="progressBar"></div>
    </div>
    <button id="startButton" style="display:none;">ابدأ الجولة</button>
  </div>

  <a-scene>
    <!-- صوت للانتقال -->
    <audio id="transitionSound" src="https://cdn.freesound.org/previews/341/341695_6261194-lq.mp3"></audio>

    <!-- HUD -->
    <a-entity id="hud" position="0 1.6 -3">
      <a-plane id="hudPlane" color="#111" width="3" height="0.6" opacity="0.6" visible="true"></a-plane>
      <a-text id="sceneLabel" value="المشهد الأول" align="center" color="#FFF" position="0 0 0.01"></a-text>
    </a-entity>

    <!-- السماء (الخلفية) -->
    <a-sky id="sky" src="scene1.jpg" rotation="0 -90 0"></a-sky>

    <!-- الحاوية للهوت سبوت -->
    <a-entity id="hotspotContainer"></a-entity>

    <!-- الكاميرا مع المؤشر -->
    <a-entity id="cameraRig" position="0 1.6 0">
      <a-camera>
        <a-cursor 
          fuse="false" 
          rayOrigin="mouse"
          material="color: white; shader: flat" 
          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03">
        </a-cursor>
      </a-camera>
    </a-entity>
  </a-scene>

  <script>
    // تعريف المشاهد والهوت سبوت
    const scenes = {
      "المشهد الأول": {
        src: "scene1.jpg",
        hotspots: [
          {position: "2 1 -3", label: "إلى المشهد الثاني", target: "المشهد الثاني"}
        ]
      },
      "المشهد الثاني": {
        src: "scene2.jpg",
        hotspots: [
          {position: "-2 1 -3", label: "رجوع للمشهد الأول", target: "المشهد الأول"}
        ]
      }
    };

    // تحميل وهمي للشريط
    let progress = 0;
    const progressBar = document.getElementById("progressBar");
    const startButton = document.getElementById("startButton");

    const interval = setInterval(() => {
      progress += 10;
      progressBar.style.width = progress + "%";
      if (progress >= 100) {
        clearInterval(interval);
        startButton.style.display = "inline-block";
      }
    }, 300);

    // عند الضغط على ابدأ الجولة
    startButton.addEventListener("click", () => {
      document.getElementById("welcomeScreen").style.display = "none";
      loadScene("المشهد الأول");
    });

    // دالة الانتقال بين المشاهد
    function changeScene(newScene) {
      const sky = document.getElementById('sky');
      const sceneLabel = document.getElementById('sceneLabel');
      const hudPlane = document.getElementById('hudPlane');

      document.getElementById('transitionSound').play();

      let newSky = document.createElement('a-sky');
      newSky.setAttribute('src', scenes[newScene].src);
      newSky.setAttribute('rotation', '0 -90 0');
      newSky.setAttribute('opacity', '0');
      newSky.setAttribute('animation__fadein', 'property: opacity; to: 1; dur: 1200; easing: easeInOutQuad');

      sky.parentNode.appendChild(newSky);
      sky.setAttribute('animation__fadeout', 'property: opacity; to: 0; dur: 1200; easing: easeInOutQuad');

      setTimeout(() => {
        sky.parentNode.removeChild(sky);
        newSky.setAttribute('id', 'sky');
      }, 1200);

      sceneLabel.setAttribute('value', newScene);
      hudPlane.setAttribute('visible', true);

      const hotspotContainer = document.getElementById('hotspotContainer');
      while (hotspotContainer.firstChild) {
        hotspotContainer.removeChild(hotspotContainer.firstChild);
      }

      scenes[newScene].hotspots.forEach(h => {
        const hotspot = document.createElement('a-entity');
        hotspot.setAttribute('geometry', 'primitive: circle; radius: 0.2');
        hotspot.setAttribute('material', 'color: #39ff14; opacity: 0.7; shader: flat');
        hotspot.setAttribute('position', h.position);
        hotspot.setAttribute('class', 'hotspot');
        hotspot.setAttribute('look-at', '#cameraRig');
        hotspot.setAttribute('event-set__enter', '_event: mouseenter; scale: 1.2 1.2 1');
        hotspot.setAttribute('event-set__leave', '_event: mouseleave; scale: 1 1 1');
        hotspot.setAttribute('onclick', `changeScene('${h.target}')`);

        const label = document.createElement('a-text');
        label.setAttribute('value', h.label);
        label.setAttribute('align', 'center');
        label.setAttribute('color', '#FFF');
        label.setAttribute('position', '0 0.3 0');
        label.setAttribute('visible', 'false');
        label.setAttribute('scale', '2 2 2');
        label.setAttribute('look-at', '#cameraRig');

        hotspot.appendChild(label);
        hotspotContainer.appendChild(hotspot);

        hotspot.addEventListener('mouseenter', () => { label.setAttribute('visible', 'true'); });
        hotspot.addEventListener('mouseleave', () => { label.setAttribute('visible', 'false'); });
      });
    }

    // تحميل أول مشهد مع الهوت سبوت
    function loadScene(sceneName) {
      const sceneLabel = document.getElementById('sceneLabel');
      const hudPlane = document.getElementById('hudPlane');
      const hotspotContainer = document.getElementById('hotspotContainer');

      sceneLabel.setAttribute('value', sceneName);
      hudPlane.setAttribute('visible', true);

      scenes[sceneName].hotspots.forEach(h => {
        const hotspot = document.createElement('a-entity');
        hotspot.setAttribute('geometry', 'primitive: circle; radius: 0.2');
        hotspot.setAttribute('material', 'color: #39ff14; opacity: 0.7; shader: flat');
        hotspot.setAttribute('position', h.position);
        hotspot.setAttribute('class', 'hotspot');
        hotspot.setAttribute('look-at', '#cameraRig');
        hotspot.setAttribute('event-set__enter', '_event: mouseenter; scale: 1.2 1.2 1');
        hotspot.setAttribute('event-set__leave', '_event: mouseleave; scale: 1 1 1');
        hotspot.setAttribute('onclick', `changeScene('${h.target}')`);

        const label = document.createElement('a-text');
        label.setAttribute('value', h.label);
        label.setAttribute('align', 'center');
        label.setAttribute('color', '#FFF');
        label.setAttribute('position', '0 0.3 0');
        label.setAttribute('visible', 'false');
        label.setAttribute('scale', '2 2 2');
        label.setAttribute('look-at', '#cameraRig');

        hotspot.appendChild(label);
        hotspotContainer.appendChild(hotspot);

        hotspot.addEventListener('mouseenter', () => { label.setAttribute('visible', 'true'); });
        hotspot.addEventListener('mouseleave', () => { label.setAttribute('visible', 'false'); });
      });
    }
  </script>
</body>
</html>
