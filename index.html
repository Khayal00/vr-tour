<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Tour with Fixed Background</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    .hotspot { cursor: pointer; }
    a-scene { background-color: #000 !important; }
  </style>
</head>
<body>
  <a-scene>
    <!-- الكاميرا -->
    <a-entity id="cameraRig" camera look-controls position="0 1.6 0">
      <a-cursor
        rayOrigin="mouse"
        raycaster="objects: .hotspot"
        fuse="false"
        geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
        material="color: white; shader: flat">
      </a-cursor>

      <!-- طبقة التلاشي -->
      <a-plane id="fadePlane" position="0 0 -0.5" width="2" height="2"
               material="color: black; opacity: 0; transparent: true"
               animation__fadeout="startEvents: fadeout; property: material.opacity; from: 0; to: 1; dur: 500"
               animation__fadein="startEvents: fadein; property: material.opacity; from: 1; to: 0; dur: 500">
      </a-plane>
    </a-entity>

    <!-- السماء -->
    <a-sky id="sky" rotation="0 -90 0"></a-sky>

    <!-- حاوية للهوت سبوت -->
    <a-entity id="hotspotContainer"></a-entity>

    <!-- تحميل الصوت -->
    <a-assets>
      <audio id="transitionSound" src="assets/transition.mp3"></audio>
      <img id="Living_Room" src="assets/Living_Room.jpg">
      <img id="Kitchen" src="assets/Kitchen.jpg">
      <img id="Reception" src="assets/Reception.jpg">
      <img id="Corridor" src="assets/Corridor.jpg">
      <img id="Bathroom" src="assets/Bathroom.jpg">
      <img id="Bedroom" src="assets/Bedroom.jpg">
    </a-assets>
  </a-scene>

  <script>
    const scenes = {
      Living_Room: {
        src: '#Living_Room',
        hotspots: [
          { target: 'Kitchen', position: '-3 1.6 4' },
          { target: 'Reception', position: '-3 1.6 -1.7' },
          { target: 'Corridor', position: '3 1.6 3' }
        ]
      },
      Kitchen: {
        src: '#Kitchen',
        hotspots: [
          { target: 'Living_Room', position: '4 1.6 -7' }
        ]
      },
      Reception: {
        src: '#Reception',
        hotspots: [
          { target: 'Living_Room', position: '5 1.6 -1' }
        ]
      },
      Corridor: {
        src: '#Corridor',
        hotspots: [
          { target: 'Bathroom', position: '3 1.6 -0.5' },
          { target: 'Bedroom', position: '-0.2 1.6 -3.5' },
          { target: 'Living_Room', position: '1 1.6 3' }
        ]
      },
      Bathroom: {
        src: '#Bathroom',
        hotspots: [
          { target: 'Corridor', position: '-1 1.6 4' }
        ]
      },
      Bedroom: {
        src: '#Bedroom',
        hotspots: [
          { target: 'Corridor', position: '-0.5 1.6 4' }
        ]
      }
    };

    function changeScene(sceneName) {
      const sky = document.querySelector('#sky');
      const hotspotContainer = document.querySelector('#hotspotContainer');
      const fadePlane = document.querySelector('#fadePlane');
      const audio = document.querySelector('#transitionSound');

      fadePlane.emit('fadeout');

      setTimeout(() => {
        sky.setAttribute('material', 'src', scenes[sceneName].src);
        hotspotContainer.innerHTML = '';

        scenes[sceneName].hotspots.forEach(hs => {
          const el = document.createElement('a-entity');
          el.setAttribute('class', 'hotspot');
          el.setAttribute('position', hs.position);

          // الكرة البيضاء
          const sphere = document.createElement('a-sphere');
          sphere.setAttribute('radius', 0.12);
          sphere.setAttribute('color', '#FFFFFF');
          sphere.setAttribute('material', 'shader: standard; emissive: #FFD700; emissiveIntensity: 0.0');
          el.appendChild(sphere);

          // حلقة التوهج
          const ring = document.createElement('a-ring');
          ring.setAttribute('position', '0 0 0');
          ring.setAttribute('rotation', '-90 0 0');
          ring.setAttribute('radius-inner', 0.25);
          ring.setAttribute('radius-outer', 1);
          ring.setAttribute('material', 'color: #FFD700; shader: flat; opacity: 0.5; transparent: true');
          el.appendChild(ring);

          // التلميح النصي
          const tooltip = document.createElement('a-entity');
          tooltip.setAttribute('text', {
            value: hs.target.replace('_', ' '),
            align: 'center',
            color: 'white',
            width: 2
          });
          tooltip.setAttribute('position', '0 0.4 0');
          tooltip.setAttribute('visible', 'false');
          tooltip.setAttribute('geometry', 'primitive: plane; width: auto; height: 0.3');
          tooltip.setAttribute('material', 'color: #000; opacity: 0.8; transparent: true');
          el.appendChild(tooltip);

          // تأثيرات التلميح
          el.addEventListener('mouseenter', () => {
            tooltip.setAttribute('visible', 'true');
            sphere.setAttribute('scale', '1.2 1.2 1.2');
            sphere.setAttribute('material', 'emissiveIntensity', 1);
            ring.setAttribute('scale', '1.5 1.5 1.5');
          });

          el.addEventListener('mouseleave', () => {
            tooltip.setAttribute('visible', 'false');
            sphere.setAttribute('scale', '1 1 1');
            sphere.setAttribute('material', 'emissiveIntensity', 0);
            ring.setAttribute('scale', '1 1 1');
          });

          // حدث النقر
          el.addEventListener('click', () => {
            audio.pause();
            audio.currentTime = 0;
            audio.play().catch(() => {});
            changeScene(hs.target);
          });

          hotspotContainer.appendChild(el);
        });

        fadePlane.emit('fadein');
      }, 500);
    }

    window.addEventListener('load', () => {
      document.body.addEventListener('click', () => {
        const audio = document.querySelector('#transitionSound');
        audio.play().catch(() => {});
      }, { once: true });

      changeScene('Living_Room');
    });
  </script>
</body>
</html>
